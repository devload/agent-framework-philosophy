"""
AutoGen ì—¬í–‰ ì¼ì • ìƒì„±ê¸°
========================

ì´ ìƒ˜í”Œì´ ë³´ì—¬ì£¼ëŠ” ê²ƒ:
- ìµœì†Œ 2~3ê°œì˜ ì—­í•  ê¸°ë°˜ ì—ì´ì „íŠ¸ê°€ ì¡´ì¬í•œë‹¤ (Planner, LocalGuide, Editor)
- ì—ì´ì „íŠ¸ë“¤ì´ ëŒ€í™”ë¥¼ í†µí•´ ê²°ê³¼ë¥¼ ì ì  ë‹¤ë“¬ëŠ”ë‹¤
- í•œ ë²ˆì— ë‹µì´ ë‚˜ì˜¤ì§€ ì•Šê³ , ìˆ˜ì •/ë³´ì™„/í•©ì˜ì˜ í”ì ì´ ë³´ì¸ë‹¤

ì² í•™: "AutoGenì€ ì—ì´ì „íŠ¸ë¥¼ ì‚¬ëŒ íŒ€ì²˜ëŸ¼ í˜‘ì—…ì‹œí‚¤ë ¤ëŠ” í”„ë ˆì„ì›Œí¬ë‹¤."

Note: ì´ ìƒ˜í”Œì€ AutoGenì˜ ì² í•™ì„ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ì‹¤ì œ LLM í˜¸ì¶œ ì—†ì´
      Mock ì‘ë‹µì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì‹¤ì œ ì‚¬ìš© ì‹œì—ëŠ” ê° ì—ì´ì „íŠ¸ì—
      LLM configë¥¼ ì„¤ì •í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.
"""

from dataclasses import dataclass, field
from typing import List, Optional, Dict, Any
from enum import Enum
import textwrap


# ============================================================
# ë©”ì‹œì§€ ë° ì—ì´ì „íŠ¸ ê¸°ë³¸ êµ¬ì¡°
# ============================================================

class Role(Enum):
    PLANNER = "Planner"      # ì¼ì • ê¸°íšì
    LOCAL_GUIDE = "LocalGuide"  # ë¶€ì‚° í˜„ì§€ ê°€ì´ë“œ
    EDITOR = "Editor"        # ìµœì¢… ê²€í† /í¸ì§‘ì


@dataclass
class Message:
    """ì—ì´ì „íŠ¸ ê°„ ì£¼ê³ ë°›ëŠ” ë©”ì‹œì§€"""
    sender: Role
    content: str
    turn: int

    def __str__(self):
        return f"[Turn {self.turn}] {self.sender.value}:\n{textwrap.indent(self.content, '  ')}"


@dataclass
class ConversationHistory:
    """ëŒ€í™” ê¸°ë¡ ê´€ë¦¬"""
    messages: List[Message] = field(default_factory=list)
    current_turn: int = 0

    def add(self, sender: Role, content: str):
        self.current_turn += 1
        msg = Message(sender=sender, content=content, turn=self.current_turn)
        self.messages.append(msg)
        return msg

    def get_context(self) -> str:
        """ì´ì „ ëŒ€í™” ë§¥ë½ì„ ë¬¸ìì—´ë¡œ ë°˜í™˜"""
        return "\n\n".join(str(m) for m in self.messages)


# ============================================================
# Mock ì—ì´ì „íŠ¸ë“¤ - ê°ê° ê³ ìœ í•œ ì—­í• ê³¼ ê´€ì ì„ ê°€ì§„ë‹¤
# ============================================================

class PlannerAgent:
    """
    Planner: ì „ì²´ ì¼ì •ì„ ê¸°íší•˜ëŠ” ì—­í• 

    íŠ¹ì§•:
    - ì „ì²´ êµ¬ì¡°ë¥¼ ì¡ëŠ”ë‹¤
    - ë…¼ë¦¬ì ì¸ ì‹œê°„ ë°°ë¶„ì„ í•œë‹¤
    - ë‹¤ë¥¸ ì—ì´ì „íŠ¸ì˜ í”¼ë“œë°±ì„ ìˆ˜ìš©í•œë‹¤
    """
    role = Role.PLANNER

    def respond(self, history: ConversationHistory, user_request: str) -> str:
        """ì‚¬ìš©ì ìš”ì²­ì— ëŒ€í•œ ì´ˆì•ˆ ë˜ëŠ” ìˆ˜ì •ì•ˆ ìƒì„±"""

        if len(history.messages) == 0:
            # ì²« ë²ˆì§¸ ì‘ë‹µ: ì´ˆì•ˆ ì‘ì„±
            return self._create_initial_draft(user_request)
        else:
            # í”¼ë“œë°± ê¸°ë°˜ ìˆ˜ì •
            return self._revise_based_on_feedback(history)

    def _create_initial_draft(self, user_request: str) -> str:
        return """ì•ˆë…•í•˜ì„¸ìš”, Plannerì…ë‹ˆë‹¤. ìš”ì²­ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.

ë¶€ì‚° 1ë°• 2ì¼ í˜¼ì ì—¬í–‰ ì¼ì • ì´ˆì•ˆì„ ì‘ì„±í–ˆìŠµë‹ˆë‹¤:

[Day 1]
- 10:00 | ì¹´í˜ì—ì„œ ì‹œì‘
- 14:00 | ì „ì‹œ ê´€ëŒ
- 18:00 | ì €ë… ì‹ì‚¬

[Day 2]
- 09:00 | ì•„ì¹¨ ì¹´í˜
- 11:00 | ê°€ë²¼ìš´ ì‚°ì±…

LocalGuideë‹˜, ë¶€ì‚° í˜„ì§€ ìƒí™©ì„ ê³ ë ¤í•´ì„œ êµ¬ì²´ì ì¸ ì¥ì†Œë¥¼ ì¶”ì²œí•´ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?
íŠ¹íˆ í˜¼ì ê°€ê¸° ì¢‹ê³ , ì¡°ìš©í•œ ê³³ ìœ„ì£¼ë¡œ ë¶€íƒë“œë¦½ë‹ˆë‹¤."""

    def _revise_based_on_feedback(self, history: ConversationHistory) -> str:
        return """LocalGuideë‹˜ì˜ ì¶”ì²œì„ ë°˜ì˜í•˜ì—¬ ì¼ì •ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.

[Day 1 - ì „í¬ë™/ìˆ˜ì˜ ê¶Œì—­]
- 10:00 | ëª¨ëª¨ìŠ¤ì»¤í”¼ (ì „í¬ë™)
  â†’ ë¶€ì‚° ìŠ¤í˜ì…œí‹° ì»¤í”¼ì˜ ì„±ì§€, í˜¼ì ì‘ì—…í•˜ê¸° ì¢‹ìŒ
- 14:00 | F1963 (ìˆ˜ì˜)
  â†’ íê³µì¥ì„ ê°œì¡°í•œ ë³µí•©ë¬¸í™”ê³µê°„, ì „ì‹œ+ì¹´í˜+ì„œì 
- 18:00 | ë°€ì–‘ìˆœëŒ€êµ­ (ë¶€ì „ë™)
  â†’ í˜¼ë°¥í•˜ê¸° í¸í•œ ë¡œì»¬ ë§›ì§‘

[Day 2 - í•´ìš´ëŒ€ ê¶Œì—­]
- 09:00 | í…Œë¼ë¡œì‚¬ (í•´ìš´ëŒ€)
  â†’ ë„“ì€ ê³µê°„, ë°”ë‹¤ ê·¼ì²˜ë¼ ì‚°ì±… ì—°ê³„ ê°€ëŠ¥
- 11:00 | í•´ìš´ëŒ€ í•´ë³€ ì‚°ì±…
  â†’ ì²´í¬ì•„ì›ƒ í›„ ê°€ë³ê²Œ ë§ˆë¬´ë¦¬

Editorë‹˜, ì´ ì¼ì •ì˜ ë™ì„ ì´ë‚˜ ì‹œê°„ ë°°ë¶„ì— ë¬¸ì œê°€ ì—†ëŠ”ì§€ ê²€í†  ë¶€íƒë“œë¦½ë‹ˆë‹¤."""


class LocalGuideAgent:
    """
    LocalGuide: ë¶€ì‚° í˜„ì§€ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ì—­í• 

    íŠ¹ì§•:
    - í˜„ì§€ì¸ë§Œ ì•„ëŠ” ì •ë³´ë¥¼ ì œê³µí•œë‹¤
    - ì‹¤ì œ ê²½í—˜ ê¸°ë°˜ íŒì„ ê³µìœ í•œë‹¤
    - Plannerì˜ ê³„íšì— í˜„ì‹¤ì„±ì„ ë”í•œë‹¤
    """
    role = Role.LOCAL_GUIDE

    def respond(self, history: ConversationHistory, user_request: str) -> str:
        """Plannerì˜ ì´ˆì•ˆì— í˜„ì§€ ì •ë³´ë¥¼ ë”í•´ êµ¬ì²´í™”"""

        return """ì•ˆë…•í•˜ì„¸ìš”, LocalGuideì…ë‹ˆë‹¤. ë¶€ì‚° í˜„ì§€ ì •ë³´ë¥¼ ê³µìœ ë“œë¦½ë‹ˆë‹¤.

Plannerë‹˜ì˜ ì¼ì •ì— ë§ì¶° ì¥ì†Œë¥¼ ì¶”ì²œë“œë¦´ê²Œìš”:

ğŸ“ ì¹´í˜ ì¶”ì²œ
1. ëª¨ëª¨ìŠ¤ì»¤í”¼ (ì „í¬ë™) â­ ê°•ë ¥ ì¶”ì²œ
   - ë¶€ì‚° 1ì„¸ëŒ€ ìŠ¤í˜ì…œí‹° ì¹´í˜, ì¡°ìš©í•˜ê³  í˜¼ì ì˜¤ëŠ” ì†ë‹˜ ë§ìŒ
   - íŒ: 2ì¸µ ì°½ê°€ì„ì´ íŠ¹íˆ ì¢‹ì•„ìš”

2. í…Œë¼ë¡œì‚¬ (í•´ìš´ëŒ€)
   - í•´ìš´ëŒ€ì—ì„œ ê°€ì¥ ë¶„ìœ„ê¸° ì¢‹ì€ ëŒ€í˜• ì¹´í˜
   - ë°”ë‹¤ ì‚°ì±…ê³¼ ì—°ê³„í•˜ê¸° ì¢‹ìŒ

ğŸ“ ì „ì‹œ ì¶”ì²œ
1. F1963 (ìˆ˜ì˜) â­ ê°•ë ¥ ì¶”ì²œ
   - ê³ ë ¤ì œê°• íê³µì¥ì„ ê°œì¡°í•œ ë³µí•©ë¬¸í™”ê³µê°„
   - ì „ì‹œ + Yes24 + ì¹´í˜ê°€ í•œ ê³³ì—
   - í˜¼ì ì™€ì„œ ë°˜ë‚˜ì ˆ ë³´ë‚´ê¸° ë”± ì¢‹ìŒ

ğŸ“ ì‹ì‚¬ ì¶”ì²œ (í˜¼ë°¥ ê°€ëŠ¥)
1. ë°€ì–‘ìˆœëŒ€êµ­ (ë¶€ì „ë™)
   - í˜„ì§€ì¸ ë§›ì§‘, í˜¼ë°¥ëŸ¬ ë§ìŒ
   - ì „í¬ë™ì—ì„œ ë„ë³´ 10ë¶„

âš ï¸ ë™ì„  íŒ
- ì „í¬ë™ â†’ F1963: íƒì‹œ 10ë¶„
- í•´ìš´ëŒ€ â†” ì „í¬ë™: ì§€í•˜ì²  30ë¶„
- Day1ì€ ì „í¬/ìˆ˜ì˜ ê¶Œì—­, Day2ëŠ” í•´ìš´ëŒ€ ê¶Œì—­ìœ¼ë¡œ ë‚˜ëˆ„ë©´ ë™ì„  íš¨ìœ¨ì 

Plannerë‹˜, ì´ ì •ë³´ ë°˜ì˜í•´ì„œ êµ¬ì²´ì ì¸ ì¼ì • ë¶€íƒë“œë ¤ìš”!"""


class EditorAgent:
    """
    Editor: ìµœì¢… ê²€í†  ë° ë‹¤ë“¬ê¸° ì—­í• 

    íŠ¹ì§•:
    - ì „ì²´ ì¼ì •ì˜ ì™„ì„±ë„ë¥¼ ë†’ì¸ë‹¤
    - ë¬¸ì œì ì„ ë°œê²¬í•˜ê³  ìˆ˜ì •ì„ ì œì•ˆí•œë‹¤
    - ìµœì¢… ê²°ê³¼ë¬¼ì„ ì •ë¦¬í•œë‹¤
    """
    role = Role.EDITOR

    def respond(self, history: ConversationHistory, user_request: str) -> str:
        """ì¼ì • ê²€í†  ë° ìµœì¢… ì •ë¦¬"""

        # ë§ˆì§€ë§‰ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ì—¬ ì‘ë‹µ ê²°ì •
        last_message = history.messages[-1] if history.messages else None

        if last_message and last_message.sender == Role.PLANNER:
            return self._review_and_finalize(history)
        else:
            return self._provide_feedback(history)

    def _provide_feedback(self, history: ConversationHistory) -> str:
        return """Editorì…ë‹ˆë‹¤. ì¼ì •ì„ ê²€í† í•´ë³´ê² ìŠµë‹ˆë‹¤.

í˜„ì¬ê¹Œì§€ ë…¼ì˜ëœ ë‚´ìš©ì„ ë³´ë‹ˆ ì¢‹ì€ êµ¬ì„±ì´ë„¤ìš”.
ë‹¤ë§Œ ëª‡ ê°€ì§€ ì œì•ˆë“œë¦½ë‹ˆë‹¤:

1. âœ… ë™ì„ : ê¶Œì—­ë³„ ë¶„ë¦¬ ì¢‹ìŠµë‹ˆë‹¤
2. âš ï¸ ì‹œê°„: F1963ì€ ìµœì†Œ 2ì‹œê°„ì€ í•„ìš”í•´ìš” (14:00-16:00 ê¶Œì¥)
3. ğŸ’¡ ì¶”ê°€ ì œì•ˆ: Day1 ì €ë… í›„ ê´‘ì•ˆë¦¬ ì•¼ê²½ë„ ê³ ë ¤í•´ë³´ì„¸ìš”

Plannerë‹˜, ì´ í”¼ë“œë°± ë°˜ì˜í•´ì„œ ìµœì¢…ì•ˆ ë§Œë“¤ì–´ì£¼ì„¸ìš”."""

    def _review_and_finalize(self, history: ConversationHistory) -> str:
        return """Editorì…ë‹ˆë‹¤. ìµœì¢… ê²€í†  ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.

âœ… ê²€í†  ê²°ê³¼: ìŠ¹ì¸

ì¼ì •ì´ ì˜ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤:
- ë™ì„ : Day1(ì „í¬/ìˆ˜ì˜), Day2(í•´ìš´ëŒ€) ê¶Œì—­ ë¶„ë¦¬ âœ“
- ì‹œê°„: ì—¬ìœ ë¡œìš´ ì¼ì •ìœ¼ë¡œ í˜¼ì ì—¬í–‰ì— ì í•© âœ“
- ì¥ì†Œ: ëª¨ë‘ í˜¼ì ê°€ê¸° ì¢‹ì€ ê³³ë“¤ âœ“
- ì‹ì‚¬: í˜¼ë°¥ ì¹œí™”ì  âœ“

ğŸ“‹ ìµœì¢… í™•ì • ì¼ì •:

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ—“ï¸ ë¶€ì‚° 1ë°• 2ì¼ í˜¼ì ì—¬í–‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ Day 1 (ì „í¬ë™/ìˆ˜ì˜ ê¶Œì—­)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  10:00 | ëª¨ëª¨ìŠ¤ì»¤í”¼ (ì „í¬ë™)
         ë¶€ì‚° ìŠ¤í˜ì…œí‹° ì»¤í”¼ì˜ ì„±ì§€
         ğŸ’­ ì¡°ìš©íˆ ì—¬í–‰ì„ ì‹œì‘í•˜ê¸° ì¢‹ì€ ê³³

  14:00 | F1963 (ìˆ˜ì˜)
         íê³µì¥ ê°œì¡° ë³µí•©ë¬¸í™”ê³µê°„
         ğŸ’­ ì „ì‹œ + ì„œì  + ì¹´í˜ë¥¼ í•œ ê³³ì—ì„œ

  18:00 | ë°€ì–‘ìˆœëŒ€êµ­ (ë¶€ì „ë™)
         í˜„ì§€ì¸ ë§›ì§‘
         ğŸ’­ í˜¼ë°¥í•˜ê¸° í¸í•œ ë¶„ìœ„ê¸°

ğŸ“ Day 2 (í•´ìš´ëŒ€ ê¶Œì—­)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  09:00 | í…Œë¼ë¡œì‚¬ (í•´ìš´ëŒ€)
         ë°”ë‹¤ ê·¼ì²˜ ëŒ€í˜• ì¹´í˜
         ğŸ’­ ë„“ì€ ê³µê°„ì—ì„œ ì—¬ìœ ë¡œìš´ ì•„ì¹¨

  11:00 | í•´ìš´ëŒ€ í•´ë³€ ì‚°ì±…
         ğŸ’­ ì²´í¬ì•„ì›ƒ í›„ ê°€ë³ê²Œ ë§ˆë¬´ë¦¬

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ êµ¬ì„± ì´ìœ 
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ ê¶Œì—­ë³„ ë¶„ë¦¬ë¡œ ì´ë™ ìµœì†Œí™”
â€¢ í˜¼ì ì—¬í–‰ì— ì í•©í•œ ì¥ì†Œë§Œ ì„ ì •
â€¢ ì¡°ìš©í•œ ì¹´í˜ì™€ ì „ì‹œ ìœ„ì£¼ êµ¬ì„±
â€¢ ì—¬ìœ ë¡œìš´ ì‹œê°„ ë°°ë¶„

âœ¨ ì¦ê±°ìš´ ë¶€ì‚° ì—¬í–‰ ë˜ì„¸ìš”!"""


# ============================================================
# ëŒ€í™” ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ - AutoGenì˜ í•µì‹¬!
# ============================================================

class TeamConversation:
    """
    AutoGenì˜ í•µì‹¬: ì—ì´ì „íŠ¸ë“¤ì˜ í˜‘ì—…ì„ ì¡°ìœ¨í•œë‹¤

    ì‹¤ì œ AutoGenì—ì„œëŠ” GroupChat, RoundRobin ë“± ë‹¤ì–‘í•œ
    ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ íŒ¨í„´ì„ ì œê³µí•œë‹¤.
    """

    def __init__(self):
        self.planner = PlannerAgent()
        self.local_guide = LocalGuideAgent()
        self.editor = EditorAgent()
        self.history = ConversationHistory()

    def run(self, user_request: str) -> str:
        """
        íŒ€ ëŒ€í™” ì‹¤í–‰

        íë¦„:
        1. Plannerê°€ ì´ˆì•ˆ ì‘ì„±
        2. LocalGuideê°€ í˜„ì§€ ì •ë³´ ì¶”ê°€
        3. Plannerê°€ í”¼ë“œë°± ë°˜ì˜í•˜ì—¬ ìˆ˜ì •
        4. Editorê°€ ê²€í†  ë° ìµœì¢… ì •ë¦¬
        """
        print("=" * 60)
        print("ğŸ¤ íŒ€ ëŒ€í™” ì‹œì‘")
        print("=" * 60)
        print(f"\nğŸ‘¤ ì‚¬ìš©ì ìš”ì²­:\n{user_request}\n")
        print("-" * 60)

        # Turn 1: Planner ì´ˆì•ˆ
        response = self.planner.respond(self.history, user_request)
        msg = self.history.add(Role.PLANNER, response)
        print(f"\n{msg}\n")
        print("-" * 60)

        # Turn 2: LocalGuide í˜„ì§€ ì •ë³´
        response = self.local_guide.respond(self.history, user_request)
        msg = self.history.add(Role.LOCAL_GUIDE, response)
        print(f"\n{msg}\n")
        print("-" * 60)

        # Turn 3: Planner ìˆ˜ì •
        response = self.planner.respond(self.history, user_request)
        msg = self.history.add(Role.PLANNER, response)
        print(f"\n{msg}\n")
        print("-" * 60)

        # Turn 4: Editor ìµœì¢… ê²€í† 
        response = self.editor.respond(self.history, user_request)
        msg = self.history.add(Role.EDITOR, response)
        print(f"\n{msg}\n")
        print("=" * 60)

        return response


# ============================================================
# ì‹¤í–‰
# ============================================================

def main():
    print("=" * 60)
    print("AutoGen ì—¬í–‰ ì¼ì • ìƒì„±ê¸°")
    print("=" * 60)
    print()
    print("ì´ ìƒ˜í”Œì´ ë³´ì—¬ì£¼ëŠ” ê²ƒ:")
    print("  - ì—­í•  ê¸°ë°˜ ì—ì´ì „íŠ¸ë“¤ì´ íŒ€ìœ¼ë¡œ í˜‘ì—…í•œë‹¤")
    print("  - ëŒ€í™”ë¥¼ í†µí•´ ê²°ê³¼ë¥¼ ì ì  ë‹¤ë“¬ì–´ê°„ë‹¤")
    print("  - ìˆ˜ì •/ë³´ì™„/í•©ì˜ì˜ ê³¼ì •ì´ ë“œëŸ¬ë‚œë‹¤")
    print()
    print("ì—ì´ì „íŠ¸ êµ¬ì„±:")
    print("  - Planner: ì „ì²´ ì¼ì • ê¸°íš")
    print("  - LocalGuide: ë¶€ì‚° í˜„ì§€ ì •ë³´ ì œê³µ")
    print("  - Editor: ìµœì¢… ê²€í†  ë° ì •ë¦¬")
    print()

    user_request = """ë¶€ì‚° 1ë°• 2ì¼ ì—¬í–‰
- í˜¼ì ì—¬í–‰
- ì¡°ìš©í•œ ì¹´í˜, ì „ì‹œ ìœ„ì£¼
- í˜¼ë°¥ ê°€ëŠ¥
- ì´ë™ ë™ì„  ìµœì†Œí™”"""

    team = TeamConversation()
    final_result = team.run(user_request)


if __name__ == "__main__":
    main()
